<div class="communities-banner" style="background-image: url('<%= image_path(@community.image) %>'); width: 100%; background-size: cover; background-position: center;">
  <h1><%= @community.name %></h1>
  <p><%= @community.users.count %> followers</p>
  <p><%= @community.description %></p>
  <% if current_user.communities.include?(@community) %>
    <p>You're following this community</p>
  <% else %>
    <%= button_to "Join", user_communities_path(id: @community.id) %>
  <% end %>
</div>

<p>Suggested books:</p>
<div class="row">
  <% books_count = 0 %>
  <% @books.each do |book| %>
    <% break if books_count == 3 %>
      <div class="col-4 d-flex flex-column align-items-center">
        <%= link_to book_path(book) do %>
          <%= image_tag(book.cover_image, alt: book.title, class: "my-bookshelf-book mb-3") %>
          <h5 class="text-center my-books-title"><%= book.title %></h5>
          <p class="text-center">by <%= book.author %></p>
        <% end %>
      </div>
    <% books_count += 1 %>
  <% end %>
</div>


<!-- Messages -->

<div class="container">
  <% if current_user.communities.include?(@community) %>
    <%= simple_form_for [@community, @message],
      html: {class: "d-flex",
            data: { controller: "reset-form", action: "turbo:submit-end->reset-form#reset" }} do |f|
    %>
      <%= f.input :content,
        label: false,
        placeholder: "Add a message",
        wrapper_html: {class: "flex-grow-1"}
      %>
      <%= f.submit "Send", class: "btn btn-primary mb-3" %>
    <% end %>

  <%= turbo_stream_from "community_#{@community.id}_messages" %>
  <div id="messages" class="messages">
    <% @messages.each do |message| %>
      <%= render partial: "messages/message", locals: { message: message, current_user: current_user } %>
    <% end %>
  </div>
  <% else %>
    <p>Follow this community to interact with other readers</p>
  <% end %>
</div>
